

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  
    <title>Configuration - Insights Results Aggregator</title>

    
  

  <link rel="shortcut icon" href="/insights-results-aggregator/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="/insights-results-aggregator/assets/css/just-the-docs-default.css">

  

  
  <script type="text/javascript" src="/insights-results-aggregator/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Configuration | Insights Results Aggregator</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Configuration" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Aggregator service for Openshist insights results" />
<meta property="og:description" content="Aggregator service for Openshist insights results" />
<link rel="canonical" href="https://redhatinsights.github.io/insights-results-aggregator/configuration.html" />
<meta property="og:url" content="https://redhatinsights.github.io/insights-results-aggregator/configuration.html" />
<meta property="og:site_name" content="Insights Results Aggregator" />
<script type="application/ld+json">
{"description":"Aggregator service for Openshist insights results","url":"https://redhatinsights.github.io/insights-results-aggregator/configuration.html","@type":"WebPage","headline":"Configuration","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
      <title>Link</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
      </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
      <title>Search</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
        <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
      </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
      <title>Menu</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
        <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
      <title>Expand</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
      <title>Document</title>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
      </svg>
    </symbol>
  </svg>

  <div class="side-bar">
    <div class="site-header">
      <a href="https://redhatinsights.github.io/insights-results-aggregator/" class="site-title lh-tight">
  Insights Results Aggregator

</a>
      <a href="#" id="menu-button" class="site-button">
        <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg>
      </a>
    </div>
    <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
      
        <ul class="nav-list"><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/architecture.html" class="nav-list-link">Architecture</a></li><li class="nav-list-item active"><a href="https://redhatinsights.github.io/insights-results-aggregator/configuration.html" class="nav-list-link active">Configuration</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/database.html" class="nav-list-link">Database</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/db_structure.html" class="nav-list-link">DB structure</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/rest_api.html" class="nav-list-link">REST API</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/authentication.html" class="nav-list-link">Authentication</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/prometheus.html" class="nav-list-link">Prometheus API</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/pprof.html" class="nav-list-link">pprof</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/rules.html" class="nav-list-link">Rules</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/testing.html" class="nav-list-link">Testing</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/ci.html" class="nav-list-link">CI</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/utilities.html" class="nav-list-link">Utilities</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/local_setup.html" class="nav-list-link">Local setup</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/documentation_for_developers.html" class="nav-list-link">Documentation for developers</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/references.html" class="nav-list-link">References</a></li><li class="nav-list-item"><a href="https://redhatinsights.github.io/insights-results-aggregator/" class="nav-list-link">Description</a></li></ul>

      
    </nav>
    <footer class="site-footer">
      This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  </div>
  <div class="main" id="top">
    <div id="main-header" class="main-header">
      
      
      
        <nav aria-label="Auxiliary" class="aux-nav">
          <ul class="aux-nav-list">
            
              <li class="aux-nav-list-item">
                <a href="https://github.com/RedHatInsights/insights-results-aggregator" class="site-button"
                  
                >
                  Github repository
                </a>
              </li>
            
          </ul>
        </nav>
      
    </div>
    <div id="main-content-wrap" class="main-content-wrap">
      
        
      
      <div id="main-content" class="main-content" role="main">
        
          <h1 class="no_toc" id="configuration">
        
        
          <a href="#configuration" class="anchor-heading" aria-labelledby="configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration
        
        
      </h1>
    
      <h2 class="no_toc text-delta" id="table-of-contents">
        
        
          <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents
        
        
      </h2>
    

<ol id="markdown-toc">
  <li><a href="#clowder-configuration" id="markdown-toc-clowder-configuration">Clowder configuration</a></li>
  <li><a href="#broker-configuration" id="markdown-toc-broker-configuration">Broker configuration</a>    <ol>
      <li><a href="#about-timeout-definition" id="markdown-toc-about-timeout-definition">About <code class="language-plaintext highlighter-rouge">timeout</code> definition</a></li>
    </ol>
  </li>
  <li><a href="#server-configuration" id="markdown-toc-server-configuration">Server configuration</a></li>
  <li><a href="#cloudwatch-configuration" id="markdown-toc-cloudwatch-configuration">CloudWatch configuration</a></li>
  <li><a href="#metrics-configuration" id="markdown-toc-metrics-configuration">Metrics configuration</a></li>
</ol>

<p>Configuration is done by toml config, default one is <code class="language-plaintext highlighter-rouge">config.toml</code> in working directory,
but it can be overwritten by <code class="language-plaintext highlighter-rouge">INSIGHTS_RESULTS_AGGREGATOR_CONFIG_FILE</code> env var.</p>

<p>Also each key in config can be overwritten by corresponding env var. For example if you have config</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[storage]</span>
<span class="py">db_driver</span> <span class="p">=</span> <span class="s">"sqlite3"</span>
<span class="py">sqlite_datasource</span> <span class="p">=</span> <span class="s">"./aggregator.db"</span>
<span class="py">pg_username</span> <span class="p">=</span> <span class="s">"user"</span>
<span class="py">pg_password</span> <span class="p">=</span> <span class="s">"password"</span>
<span class="py">pg_host</span> <span class="p">=</span> <span class="s">"localhost"</span>
<span class="py">pg_port</span> <span class="p">=</span> <span class="mi">5432</span>
<span class="py">pg_db_name</span> <span class="p">=</span> <span class="s">"aggregator"</span>
<span class="py">pg_params</span> <span class="p">=</span> <span class="s">""</span>
</code></pre></div></div>

<p>and environment variables</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">INSIGHTS_RESULTS_AGGREGATOR__STORAGE__DB_DRIVER</span><span class="o">=</span><span class="s2">"postgres"</span>
<span class="nv">INSIGHTS_RESULTS_AGGREGATOR__STORAGE__PG_PASSWORD</span><span class="o">=</span><span class="s2">"your secret password"</span>
</code></pre></div></div>

<p>the actual driver will be postgres with password “your secret password”</p>

<p>It’s very useful for deploying docker containers and keeping some of your configuration
outside of main config file(like passwords).</p>
      <h3 id="clowder-configuration">
        
        
          <a href="#clowder-configuration" class="anchor-heading" aria-labelledby="clowder-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clowder configuration
        
        
      </h3>
    

<p>In Clowder environment, some configuration options are injected automatically.
Currently Kafka broker configuration is injected this side. To test this
behavior, it is possible to specify path to Clowder-related configuration file
via <code class="language-plaintext highlighter-rouge">AGG_CONFIG</code> environment variable:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export ACG_CONFIG="clowder_config.json"
</code></pre></div></div>
      <h2 id="broker-configuration">
        
        
          <a href="#broker-configuration" class="anchor-heading" aria-labelledby="broker-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Broker configuration
        
        
      </h2>
    

<p>Broker configuration is in section <code class="language-plaintext highlighter-rouge">[broker]</code> in config file</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[broker]</span>
<span class="py">address</span> <span class="p">=</span> <span class="s">"localhost:9092"</span>
<span class="py">timeout</span> <span class="p">=</span> <span class="s">"30s"</span>
<span class="py">topic</span> <span class="p">=</span> <span class="s">"topic"</span>
<span class="py">payload_tracker_topic</span> <span class="p">=</span> <span class="s">"payload-tracker-topic"</span>
<span class="py">service_name</span> <span class="p">=</span> <span class="s">"insights-results-aggregator"</span>
<span class="py">group</span> <span class="p">=</span> <span class="s">"aggregator"</span>
<span class="py">enabled</span> <span class="p">=</span> <span class="kc">true</span>
<span class="py">save_offset</span> <span class="p">=</span> <span class="kc">true</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">address</code> is an address of kafka broker (DEFAULT: “”)</li>
  <li><code class="language-plaintext highlighter-rouge">timeout</code> is the time used as timeout for the Kafka client networking side. See notes above</li>
  <li><code class="language-plaintext highlighter-rouge">topic</code> is a topic to consume messages from (DEFAULT: “”)</li>
  <li><code class="language-plaintext highlighter-rouge">payload_tracker_topic</code> is a topic to which messages for the Payload Tracker are published (see <code class="language-plaintext highlighter-rouge">producer</code> package) (DEFAULT: “”)</li>
  <li><code class="language-plaintext highlighter-rouge">service_name</code> is the name of this service as reported to the Payload Tracker (DEFAULT: “”)</li>
  <li><code class="language-plaintext highlighter-rouge">group</code> is a kafka group (DEFAULT: “”)</li>
  <li><code class="language-plaintext highlighter-rouge">enabled</code> is an option to turn broker on (DEFAULT: false)</li>
  <li><code class="language-plaintext highlighter-rouge">save_offset</code> is an option to turn on saving offset of successfully consumed messages.
The offset is stored in the same kafka broker. If it turned off,
consuming will be started from the most recent message (DEFAULT: false)</li>
</ul>

<p>Option names in env configuration:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">address</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__ADDRESS</li>
  <li><code class="language-plaintext highlighter-rouge">timeout</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__TIMEOUT</li>
  <li><code class="language-plaintext highlighter-rouge">topic</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__TOPIC</li>
  <li><code class="language-plaintext highlighter-rouge">payload_tracker_topic</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__PAYLOAD_TRACKER_TOPIC</li>
  <li><code class="language-plaintext highlighter-rouge">service_name</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__SERVICE_NAME</li>
  <li><code class="language-plaintext highlighter-rouge">group</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__GROUP</li>
  <li><code class="language-plaintext highlighter-rouge">enabled</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__ENABLED</li>
  <li><code class="language-plaintext highlighter-rouge">save_offset</code> - INSIGHTS_RESULTS_AGGREGATOR__BROKER__SAVE_OFFSET</li>
</ul>
      <h3 id="about-timeout-definition">
        
        
          <a href="#about-timeout-definition" class="anchor-heading" aria-labelledby="about-timeout-definition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> About <code class="language-plaintext highlighter-rouge">timeout</code> definition
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">timeout</code> configuration should be an string that can be parsed by the
function <a href="https://golang.org/pkg/time/#ParseDuration"><code class="language-plaintext highlighter-rouge">time.ParseDuration</code></a> from
Golang standard library.</p>

<p>This timeout will be applied as the configuration for dial, read and write
timeouts of the Sarama Kafka library.</p>
      <h2 id="server-configuration">
        
        
          <a href="#server-configuration" class="anchor-heading" aria-labelledby="server-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Server configuration
        
        
      </h2>
    

<p>Server configuration is in section <code class="language-plaintext highlighter-rouge">[server]</code> in config file.</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[server]</span>
<span class="py">address</span> <span class="p">=</span> <span class="s">":8080"</span>
<span class="py">api_prefix</span> <span class="p">=</span> <span class="s">"/api/v1/"</span>
<span class="py">api_spec_file</span> <span class="p">=</span> <span class="s">"openapi.json"</span>
<span class="py">debug</span> <span class="p">=</span> <span class="kc">true</span>
<span class="py">auth</span> <span class="p">=</span> <span class="kc">true</span>
<span class="py">auth_type</span> <span class="p">=</span> <span class="s">"xrh"</span>
<span class="py">maximum_feedback_message_length</span> <span class="p">=</span> <span class="mi">255</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">address</code> is host and port which server should listen to</li>
  <li><code class="language-plaintext highlighter-rouge">api_prefix</code> is prefix for RestAPI path</li>
  <li><code class="language-plaintext highlighter-rouge">api_spec_file</code> is the location of a required OpenAPI specifications file</li>
  <li><code class="language-plaintext highlighter-rouge">debug</code> is developer mode that enables some special API endpoints not used on production. In
production, <code class="language-plaintext highlighter-rouge">false</code> is used every time.</li>
  <li><code class="language-plaintext highlighter-rouge">auth</code> turns on or turns authentication. Please note that this option can be set to <code class="language-plaintext highlighter-rouge">false</code> only
in devel environment. In production, <code class="language-plaintext highlighter-rouge">true</code> is used every time.</li>
  <li><code class="language-plaintext highlighter-rouge">auth_type</code> set type of auth, it means which header to use for auth <code class="language-plaintext highlighter-rouge">x-rh-identity</code> or
<code class="language-plaintext highlighter-rouge">Authorization</code>. Can be used only with <code class="language-plaintext highlighter-rouge">auth = true</code>. Possible options: <code class="language-plaintext highlighter-rouge">jwt</code>, <code class="language-plaintext highlighter-rouge">xrh</code></li>
  <li><code class="language-plaintext highlighter-rouge">maximum_feedback_message_length</code> is a maximum possible length of a string for user’s feedback</li>
</ul>

<p>Please note that if <code class="language-plaintext highlighter-rouge">auth</code> configuration option is turned off, not all REST API endpoints will be
usable. Whole REST API schema is satisfied only for <code class="language-plaintext highlighter-rouge">auth = true</code>.</p>
      <h2 id="cloudwatch-configuration">
        
        
          <a href="#cloudwatch-configuration" class="anchor-heading" aria-labelledby="cloudwatch-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CloudWatch configuration
        
        
      </h2>
    

<p>CloudWatch configuration is in section <code class="language-plaintext highlighter-rouge">[cloudwatch]</code> in config file</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[cloudwatch]</span>
<span class="py">aws_access_id</span> <span class="p">=</span> <span class="s">"a key id"</span>
<span class="py">aws_secret_key</span> <span class="p">=</span> <span class="s">"tshhhh it is a secret"</span>
<span class="py">aws_session_token</span> <span class="p">=</span> <span class="s">""</span>
<span class="py">aws_region</span> <span class="p">=</span> <span class="s">"us-east-1"</span>
<span class="py">log_group</span> <span class="p">=</span> <span class="s">"platform-dev"</span>
<span class="py">stream_name</span> <span class="p">=</span> <span class="s">"insights-results-aggregator"</span>
<span class="py">debug</span> <span class="p">=</span> <span class="kc">false</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">aws_access_id</code> is an aws access id</li>
  <li><code class="language-plaintext highlighter-rouge">aws_secret_key</code> is an aws secret key</li>
  <li><code class="language-plaintext highlighter-rouge">aws_session_token</code> is an aws session token</li>
  <li><code class="language-plaintext highlighter-rouge">aws_region</code> is an aws region</li>
  <li><code class="language-plaintext highlighter-rouge">log_group</code> is a log group for aws logging</li>
  <li><code class="language-plaintext highlighter-rouge">stream_name</code> is a stream name for aws logging. If you’re deploying multiple pods,
you can add <code class="language-plaintext highlighter-rouge">$HOSTNAME</code> to the stream name so that they aren’t writing to the same stream at once</li>
  <li><code class="language-plaintext highlighter-rouge">debug</code> is an option to enable debug output of cloudwatch logging</li>
</ul>
      <h2 id="metrics-configuration">
        
        
          <a href="#metrics-configuration" class="anchor-heading" aria-labelledby="metrics-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metrics configuration
        
        
      </h2>
    

<p>Metrics configuration is in section <code class="language-plaintext highlighter-rouge">[metrics]</code> in config file</p>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[metrics]</span>
<span class="py">namespace</span> <span class="p">=</span> <span class="s">"mynamespace"</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">namespace</code> if defined, it is used as <code class="language-plaintext highlighter-rouge">Namespace</code> argument when creating all
the Prometheus metrics exposed by this service.</li>
</ul>

        

        

        
        
          <hr>
          <footer>
            

            <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2020 Red Hat, Inc.</a></p>

            
          </footer>
        

      </div>
    </div>

    
  </div>
</body>
</html>

